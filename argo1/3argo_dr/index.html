
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Jacob's Gitlab Tutorial Book">
      
      
        <meta name="author" content="Jacob Xi">
      
      
        <link rel="canonical" href="https://chao-xi.github.io/jxgitlabbook/argo1/3argo_dr/">
      
      
        <link rel="prev" href="../2Argo_Rollouts/">
      
      
        <link rel="next" href="../4argo_rollouts_ab/">
      
      
      <link rel="icon" href="../../images/logo.jpeg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>3 DevOps中的Argo CD — 灾难恢复 - Jacob GitLab Book</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="purple" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#3-devopsargo-cd" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="Jacob GitLab Book" class="md-header__button md-logo" aria-label="Jacob GitLab Book" data-md-component="logo">
      
  <img src="../../images/logo.jpeg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Jacob GitLab Book
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              3 DevOps中的Argo CD — 灾难恢复
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Chao-Xi/jxgitlabbook.git" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    jxgitlabbook
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Jacob GitLab Book" class="md-nav__button md-logo" aria-label="Jacob GitLab Book" data-md-component="logo">
      
  <img src="../../images/logo.jpeg" alt="logo">

    </a>
    Jacob GitLab Book
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Chao-Xi/jxgitlabbook.git" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    jxgitlabbook
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    GitLab Fundamentals
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            GitLab Fundamentals
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap0/1proj/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Project and Repositoires
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap0/4issues/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gitlab Issues and Timelines
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Gitlab 简介
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Gitlab 简介
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/1gitlab_cicd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1 Gitlab 基本介绍（CI/CD)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/2gitlab_branch_strategy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2 Gitlab branch Strategy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/3gitlab_install_quick/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3 安装配置Gitlab
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/4gitlab_install_k8s/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4 在Kubernetes上安装Gitlab
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Gitlab Runner配置&安装
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Gitlab Runner配置&安装
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/1gitruner_intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1 GitLab Runner 简介
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/2gitrunner_install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2 GitLab Runner安装注册配置管理
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pipeline 核心语法
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Pipeline 核心语法
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/1gitlab_pip1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GitLabCI系列之流水线语法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/2gitlab_summary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2 Gitlab CI 流水线构建优化 + Runner构建优化（持久化）
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/3gitlab_config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3 配置复杂的 Gitlab CI/CD Pipeline
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Gitlab工具链集成
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Gitlab工具链集成
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/1git_template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1 模板库设计Maven+NPM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/2git_sonar_pr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2 Gitlab 工具链集成-代码质量平台集成
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/3gitlab_artifact_docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3 工具链集成-制品库集成
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/4gitlab_jemeter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4 Gitlab 自动化测试集成
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/5gitlba_mon/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5 GitLabCI/CD Prom构建数据采集与监控
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Gitlab + Kubernetes集成
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Gitlab + Kubernetes集成
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5/1gitlab-runner-install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1 基于K8S安装部署Runner
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5/2gitlab_k8s/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2 Kubernetes 容器流水线
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5/3gitlab_notification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3 Kubernetes 流水线构建消息通知
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5/4gitlab_distri_storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4 Gitlab + minio 配置使用分布式缓存
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Gitlab流水线最佳实践
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Gitlab流水线最佳实践
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6/1pip_init/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1 流水线设计及提交
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6/2pip_design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2 提交流水线设计
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6/3pip_run/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3 流水线运行
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6/4pip_secret/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4 如何将Secrets扫描加入到GitLab Pipeline
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    项目交付流水线
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            项目交付流水线
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap7/1deploy_pip/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1 项目交付流水线优化后模板库配置
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap7/2deploy_projs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2 项目流水线(JAVA+NPM+安卓)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    gitlab Certified CICD
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            gitlab Certified CICD
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8/1cer_prep1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GitLab Certified CI/CD Specialist Training
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8/2pip_prep1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Anatomy of a Pipeline
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8/3Gitlab_pip/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gitlab Pipeline 复习
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8/4Final_test/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gitlab 认证考题
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    gitlab Project Management
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            gitlab Project Management
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/1Gitlab_branch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    L1 Gitlab branch Strategy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/2gitlab_workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    L2 Gitflow Workflow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/3Gitlab_branch_action/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    L3 Gitlab branch Settup Action
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/4gitlab_project/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    L4 Agile Planning with GitLab
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/4gitlab_project/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    L4 Agile Planning with GitLab
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" checked>
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ArgoCD Project
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            ArgoCD Project
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0gitops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0 GitOps 常用工具盘点
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1argo2023_gitops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1 使用 Argo CD 进行 GitOps 流水线改造- 2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2Argo_Rollouts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2 使用 Argo Rollouts 实现应用渐进式发布
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    3 DevOps中的Argo CD — 灾难恢复
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    3 DevOps中的Argo CD — 灾难恢复
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#argo-cd" class="md-nav__link">
    <span class="md-ellipsis">
      为什么要对 Argo CD 进行灾难恢复？
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#argo-cd_1" class="md-nav__link">
    <span class="md-ellipsis">
      什么是 Argo CD 灾难恢复？
    </span>
  </a>
  
    <nav class="md-nav" aria-label="什么是 Argo CD 灾难恢复？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#argocd-admin" class="md-nav__link">
    <span class="md-ellipsis">
      “argocd admin”命令
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      从备份恢复
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      自动化备份过程
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4argo_rollouts_ab/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4 A/B测试: 如何使用Argo Rollouts 进行渐进式交付
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../6gitops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5 GitOps 简介
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../7k8s_yaml_cicd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6 K8S YAML 资源清单管理方案
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../8cd_image_updater/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7 ArgoCD Image Updater
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
        
          
          <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Github Action
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            Github Action
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap10/1action_docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    基于GitHubActions同步Docker镜像实践
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap10/2action_workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GitHub Action - CI/CD Pipeline with Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap10/3action_events/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GitHub Actions basic learning
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#argo-cd" class="md-nav__link">
    <span class="md-ellipsis">
      为什么要对 Argo CD 进行灾难恢复？
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#argo-cd_1" class="md-nav__link">
    <span class="md-ellipsis">
      什么是 Argo CD 灾难恢复？
    </span>
  </a>
  
    <nav class="md-nav" aria-label="什么是 Argo CD 灾难恢复？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#argocd-admin" class="md-nav__link">
    <span class="md-ellipsis">
      “argocd admin”命令
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      从备份恢复
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      自动化备份过程
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="3-devopsargo-cd">3 DevOps中的Argo CD — 灾难恢复</h1>
<h2 id="argo-cd">为什么要对 Argo CD 进行灾难恢复？</h2>
<p>重要的是要了解 Argo CD 不直接与任何数据库交互，仅利用 Redis 作为缓存机制，使其看起来是无状态的。正如我们之前讨论的，主要通过增加每个部署的副本数量来实现高可用性安装是可能的。</p>
<p>但是，Argo CD 确实以应用程序定义（例如 Git 源和目标集群）、访问 Kubernetes 集群的信息以及连接到私有 Git 或 Helm 存储库的详细信息的形式维护状态。<strong>Argo CD 的此状态信息存储在 Kubernetes 资源中。其中一些是本机功能，例如连接详细信息的秘密，而另一些是针对应用程序和应用程序约束的自定义功能</strong>。</p>
<p>不可预见的情况，包括删除 Kubernetes 集群或 Argo CD 命名空间等人为行为，或者云提供商的复杂情况，都可能导致灾难。</p>
<p>还可能存在需要将 Argo CD 安装从一个集群转移到另一个集群的情况。所以Argo CD灾难恢复对于生产环境来说是必要的。</p>
<p>另外，请记住在 Argo CD 中：</p>
<ul>
<li><strong>并非所有内容都会保存到 Git 存储库中</strong>。</li>
<li><strong>从 Git 存储库重新创建所有内容可能需要花费大量时间，尤其是当您有大量应用程序时</strong></li>
</ul>
<h2 id="argo-cd_1">什么是 Argo CD 灾难恢复？</h2>
<p>Argo CD 灾难恢复是在灾难性事件发生后恢复 Argo CD 部署的过程，例如人为错误（例如，删除 Argo CD 命名空间或 Kubernetes 集群）、软件错误或基础设施问题（例如，云提供商中断或数据中心）失败）。</p>
<p>灾难恢复的目的是使您的系统恢复到正常运行状态，同时最大限度地减少停机时间和数据丢失。这包括恢复应用程序部署状态、恢复 Argo CD 数据库以及恢复 Git 存储库和 Kubernetes 集群之间的同步。</p>
<p><strong>它通常涉及以下步骤：</strong></p>
<ul>
<li><strong>备份</strong>：定期备份重要数据，例如 Argo CD 数据库和 Argo CD 用于连接 Git 存储库或 Kubernetes 集群的 Kubernetes Secrets。备份频率通常取决于您更改应用程序的频率。</li>
<li><strong>恢复</strong>：如果发生灾难，您可以从备份恢复Argo CD 安装。这通常涉及创建新的 Argo CD 实例并将备份数据加载到其中。 </li>
<li><strong>验证</strong>：恢复后，验证恢复是否成功非常重要。这可能涉及检查所有应用程序是否处于正确状态，并且 Argo CD 可以正确地将所需状态从 Git 同步到 Kubernetes 集群。</li>
</ul>
<h3 id="argocd-admin">“argocd admin”命令</h3>
<p>“argocd admin”命令包含一组对 Argo CD 管理员有用的命令，并且需要直接 Kubernetes 访问。</p>
<p>语法如下：</p>
<pre><code>$ argocd admin [flags] [commands]

Usage:
  argocd admin [flags]
  argocd admin [command]

Available Commands:
  app              Manage applications configuration
  cluster          Manage clusters configuration
  dashboard        Starts Argo CD Web UI locally
  export           Export all Argo CD data to stdout (default) or a file
  import           Import Argo CD data from stdin (specify `-') or a file
  initial-password Prints initial password to log in to Argo CD for the first time
  notifications    Set of CLI commands that helps manage notifications settings
  proj             Manage projects configuration
  repo             Manage repositories configuration
  settings         Provides set of commands for settings validation and troubleshooting
</code></pre>
<p><strong>创建备份</strong></p>
<p>现在，让我们连接到集群并创建备份。您应该连接到安装了 Argo CD 的集群。</p>
<p>运行以下命令，这将根据当前日期和时间创建一个具有自定义名称的文件：</p>
<pre><code>$ argocd admin export -n argocd &gt; argocd-backup-$(date +&quot;%Y-%m-%d_%H:%M&quot;).yml

$ ls -l
-rw-rw-r-- 1 txu  txu  63010 Jun 14 20:18 argocd-backup-2023-06-14_20:18.yml
</code></pre>
<p>下一步，您应该获取此备份文件并将其保存在云存储系统（例如 AWS S3、Azure Blob 或 Google Cloud Storage）上，对其进行加密并制定访问策略。</p>
<h3 id="_1">从备份恢复</h3>
<p>恢复备份需要在目标集群中初始安装 Argo CD。备份包括其配置以及所有相关的 ConfigMap 和 Secret，其中应包含初始设置期间所做的所有修改。</p>
<p>运行以下命令：</p>
<pre><code>$ argocd admin import - &lt; argocd-backup-2023-06-14_20:18.yml
...
/ConfigMap argocd-cm created
/ConfigMap argocd-rbac-cm created
/ConfigMap argocd-ssh-known-hosts-cm created
/ConfigMap argocd-tls-certs-cm created
/Secret argocd-secret created
/Secret autopilot-secret created
argoproj.io/AppProject default created
argoproj.io/AppProject testing created
argoproj.io/Application argo-cd created
argoproj.io/Application autopilot-bootstrap created
argoproj.io/Application cluster-resources-in-cluster created
argoproj.io/Application root created
argoproj.io/ApplicationSet cluster-resources created
argoproj.io/ApplicationSet testing created
</code></pre>
<p>恢复过程完成后，您的新安装应该复制备份时的状态，包括所有应用程序、集群和 Git 存储库。</p>
<p><strong><mark>关键区别在于 Redis 缓存中没有数据。因此，Argo CD 将需要开始重新处理 Git 存储库中的所有清单，这最初可能会影响系统性能。然而，这种情况应该会在几分钟后稳定下来，使操作恢复到正常状态。</mark></strong></p>
<h3 id="_2">自动化备份过程</h3>
<p>一旦完全测试了备份和恢复命令，您就应该开始自动化备份过程。</p>
<p>自动化 Argo CD 备份过程可以带来显着的好处，尤其是在生产环境中：</p>
<ul>
<li>
<p>一致性：自动化确保备份过程每次都一致执行，减少人为错误的可能性。它还保证备份所有必要的资源。</p>
</li>
<li>
<p>频率：可以安排自动备份定期运行，确保您始终拥有最新的备份。这对于频繁发生变化的活跃环境尤其重要。</p>
</li>
<li>
<p>效率：自动备份过程比手动备份过程高效得多，可以释放人力资源来执行更复杂的任务。</p>
</li>
<li>
<p>速度和恢复时间：当灾难发生时，拥有一个经过验证的自动化备份过程可以显着加快恢复时间，从而最大限度地减少停机时间。</p>
</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2021-9999 Jacob Xi
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>